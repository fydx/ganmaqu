<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map_canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="http://maps.googleapis.com/maps/api/js?key=AIzaSyD5LGXb8bgnTOhSjSZAxldP8kzTkmf3YQ0&sensor=true&language=zh-cn">
    </script>
    <script type="text/javascript">
 
      var directionsDisplay;
      var directionsService = new google.maps.DirectionsService();
      var map;
      var ori = new google.maps.LatLng(34.2179, 108.9123);
      var des = new google.maps.LatLng(34.2224, 108.9468);
      var status_net;
      var infowindow = new google.maps.InfoWindow();
     
     function addMessage()
     {

       
        for (var i = 0 ;i <arguments.length; i+=3) {
          var marker = new google.maps.Marker({
           position: new google.maps.LatLng(arguments[i], arguments[i+1]),
           map: map,
           title: "in"
         });
         attachSecretMessage(marker,i/3,arguments[i+2]);

       };
     }
      function refresh()
      {
         
         var message = ['This', 'is', 'the', 'secret', 'message'];
         var mapOptions = {
          center: new google.maps.LatLng(34.2595, 108.9476),
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
        for (var i = 0 ;i <arguments.length; i+=3) {
          var marker = new google.maps.Marker({
           position: new google.maps.LatLng(arguments[i], arguments[i+1]),
           map: map,
           title: "in"
         });
         attachSecretMessage(marker,i/3,arguments[i+2]);
       };
      }     
      function initialize() {
         directionsDisplay = new google.maps.DirectionsRenderer();
        var mapOptions = {
          center: new google.maps.LatLng(34.2595, 108.9476),
          zoom: 12,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
       map = new google.maps.Map(document.getElementById("map_canvas"),
            mapOptions);
        directionsDisplay.setMap(map);
        //console.log("Hello World");
        //calcRoute2(34.260230,108.943180);

      
      // addMessage(34.2179,108.9123,"111",34.2224,108.9468,"222");
        //addmarker(34.2179,108.9123);
        //addMessage(34.26023,108.94318, "狼人真人密室逃脱" );
       // addmarker(34.2224,108.9468);

      }
        function attachSecretMessage(marker,num,message) {
      //var message = ['This', 'is', 'the', 'secret', 'message'];
      
      

       google.maps.event.addListener(marker, 'click', function() {
         infowindow.close();
         infowindow = new google.maps.InfoWindow({
       content: message
       });
         infowindow.open(marker.get('map'), marker);
       
       });
      }
        function addmarker(pos_x,pos_y)
       {
          
         marker = new google.maps.Marker({
           position: new google.maps.LatLng(pos_x,pos_y),
           map: map,
           title: 'Click to zoom',
         });

          //addInfo(marker);
        
       
      }
       function addmarker(pos_x,pos_y,info)
       {
      
          var marker = new google.maps.Marker({
           position: new google.maps.LatLng(pos_x,pos_y),
           map: map,
           title: info
         });
        
       
      }
      function addInfo(marker)
      {
          alert("info");
          var infowindow = new google.maps.InfoWindow({
          content: "contentString"
         });
        
          google.maps.event.addListener(marker, 'click', function() {
         infowindow.open(map,marker);
         }); 
      }
      function calcRoute()
      {
        
      var result;     
      var request = {
          origin: ori,
          destination: des,
          travelMode: google.maps.TravelMode.TRANSIT
      };
      
      directionsService.route(request, function(response, status) {
      //  alert(status);
           // var myRoute = response.routes[0].legs[0];
           // alert(myRoute.steps[0].transit.headsign);
       if (status == google.maps.DirectionsStatus.OK) {
          // alert("111");
           
          status_net = "1"; 
          result = "111";
          directionsDisplay.setDirections(response);
          var route = response.routes[0];
           alert(route.legs[i].start_address);
         // showSteps(response);  

       }
       });
      alert("1111");
      if (status_net == "1") {
        alert("11111");
      };

      }
      function calcRoute2(pos_x,pos_y)
      {
        
      var request = {
          origin: new google.maps.LatLng(34.2339, 108.9186),
          destination: new google.maps.LatLng(pos_x, pos_y),
          travelMode: google.maps.TravelMode.TRANSIT
      };
      directionsService.route(request, function(response, status) {
       // alert(status);
       if (status == google.maps.DirectionsStatus.OK) {
          directionsDisplay.setDirections(response);
           showSteps(response);
       }
       });
      }
      function showSteps(directionResult) {
       // For each step, place a marker, and add the text to    the marker's
       // info window. Also attach the marker to an array so we
        // can keep track of it and remove it when calculating new
       // routes.
       var myRoute = directionResult.routes[0].legs[0];
      alert(myRoute.steps[0].transit.headsign);
      for (var i = 0; i < myRoute.steps.length; i++) {
      var marker = new google.maps.Marker({
        position: myRoute.steps[i].start_point,
        map: map
      });
      attachInstructionText(marker, myRoute.steps[i].instructions);
      alert(i);
     
      markerArray[i] = marker;
  }
}

function attachInstructionText(marker, text) {
  google.maps.event.addListener(marker, 'click', function() {
    stepDisplay.setContent(text);
    stepDisplay.open(map, marker);
  });
}
 

      function detectBrowser() {
       var useragent = navigator.userAgent;
       var mapdiv = document.getElementById("map_canvas");

       if (useragent.indexOf('iPhone') != -1 || useragent.indexOf('Android') != -1 ) {
       mapdiv.style.width = '100%';
       mapdiv.style.height = '100%';
       } else {
       mapdiv.style.width = '600px';
       mapdiv.style.height = '800px';
  }
}
  
   google.maps.event.addDomListener(window, 'load', initialize);
   
    </script>

  </head>
  <body onload="initialize()">
    <div id="map_canvas" style="width:100%; height:100%"></div>
  </body>
</html>